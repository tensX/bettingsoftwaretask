# Настройка сервера раздачи статики с помощью Ansible и Docker

Этот проект представляет собой Ansible-плейбук и набор ролей для настройки сервера раздачи статических файлов с использованием Nginx. Тестовое окружение построено на Docker-контейнере, запускаемом через Docker Compose.

## Шаги по запуску

### 1. Клонирование репозитория

Клонируйте репозиторий с проектом:

```bash
git clone https://github.com/tensX/bettingsoftwaretask.git
cd bettingsoftwaretask
```

### 2. Установка Docker и Docker Compose
Убедитесь, что у вас установлены следующие версии на хост машине:   
>>
Docker: версии 27.3.1 или выше  
Docker Compose: версии v2.29.7 или выше  
ОС Ubuntu 24.10 x64.

### 3. Подготовка SSH-ключей
Вам был предоставлен приватный SSH-ключ для подключения к контейнеру.  
Сохраните этот ключ в безопасном месте на вашем компьютере и убедитесь, что у него правильные права доступа:

```bash
chmod 600 /путь/до/вашего/id_rsa_private_key
```

### 4. Обновление файла ansible/inventory.yml
Укажите путь до вашего приватного ключа в файле ```ansible/inventory.yml```:
``` yaml
all:
  hosts:
    static_server:
      ansible_host: 68.183.216.238
      ansible_port: 2222
      ansible_ssh_private_key_file: "/путь/до/вашего/id_rsa_private_key"
      ansible_ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'
```

### 5. Запуск Docker-контейнера
Запустите контейнер с помощью Docker Compose:
``` bash
docker-compose up -d
```

### 6. Запуск Ansible-плейбука
Запустите Ansible-плейбук для настройки сервера:
``` bash
ansible-playbook -i ansible/inventory.yml ansible/site.yml
```

**Примечание:** Плейбук автоматически определяет, под каким пользователем подключаться (root или ansible_user), и выполняет все необходимые действия.

## Краткое описание

-   **Docker-контейнер**: Создает тестовое окружение на базе Ubuntu 24.10 x64 с установленным `openssh-server`.
-   **Ansible-плейбук**: Настраивает сервер для раздачи статических файлов с помощью Nginx и выполняет следующие роли:
    -   Создание пользователей и групп.
    -   Установка дополнительных утилит (`htop`, `ncdu`, `git`, `nano`).
    -   Настройка SSH-сервера (запрет входа для root, настройка логирования и т.д.).
    -   Установка Zsh и Oh My Zsh для определенных пользователей.
    -   Установка и настройка Nginx для раздачи статики по пути `/images`.
    -   Загрузка статических файлов в каталог `/var/www/html/images/`.


## Проверка работы

-   **Доступ к статическим файлам**:
    
    Перейдите по адресу `http://68.183.216.238/images/`, чтобы увидеть список файлов.
``` bash
ssh ansible_user@68.183.216.238 -p 2222 -i /путь/до/вашего/id_rsa_private_key
```

## Замечания

-   **SSH-ключи**: Публичные ключи уже добавлены для пользователей в контейнере. Вам необходимо только указать путь до приватного ключа.
-   **Права доступа**: Убедитесь, что у приватного ключа установлены правильные права доступа (`chmod 600`).
-   **Docker и Docker Compose**: Убедитесь, что используете указанные версии для совместимости.
-   **Ubuntu**: Контейнер и плейбук были протестированы на Ubuntu 24.10 x64.
-   **Замена ресурса для изображений**: Тестовый хост расположен на DigitalOcean, где нет доступа к Imgur. Поэтому для загрузки изображений используется другой ресурс.

## Дополнительная информация

-   **Роли Ansible**:
    
    -   **users**: Создает пользователей и группы, настраивает SSH-ключи, устанавливает права sudo без пароля.
    -   **utilities**: Обновляет систему и устанавливает дополнительные утилиты (`htop`, `ncdu`, `git`, `nano`).
    -   **ssh**: Настраивает SSH-сервер:
        -   Запрещает вход под пользователем root.
        -   Запрещает пустые пароли.
        -   Включает подробное логирование (VERBOSE).
        -   Отключает X11Forwarding.
    -   **zsh**: Устанавливает Zsh и Oh My Zsh для пользователей с оболочкой `/bin/zsh`.
    -   **nginx**: Устанавливает и настраивает Nginx для раздачи статических файлов по пути `/images`, включает gzip-сжатие и настраивает кэширование.
    -   **static**: Загружает статические изображения в каталог `/var/www/html/images/`.
-   **Переменные**:
    
    Переменные для пользователей и групп определены в `ansible/group_vars/all.yml`. Вы можете изменить их по необходимости.
